<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokens and Tokenization - Medical AI Learning System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .nav-tab:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: #27ae60;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .main-content {
            display: grid;
            gap: 30px;
            grid-template-columns: 1fr;
        }

        .panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .panel.active {
            display: block;
        }

        .panel h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .input-group textarea,
        .input-group input,
        .input-group select {
            width: 100%;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: 'Consolas', 'Monaco', monospace;
        }

        .input-group textarea:focus,
        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }

        .btn {
            background: #3498db;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn.success {
            background: #27ae60;
        }

        .btn.success:hover {
            background: #229954;
        }

        .btn.warning {
            background: #f39c12;
        }

        .btn.warning:hover {
            background: #e67e22;
        }

        .btn.danger {
            background: #e74c3c;
        }

        .btn.danger:hover {
            background: #c0392b;
        }

        .results-area {
            margin-top: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 5px solid #3498db;
        }

        .token-visualization {
            margin: 20px 0;
            padding: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .token-display {
            line-height: 2;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 16px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            margin: 15px 0;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .token {
            padding: 2px 6px;
            margin: 2px;
            border-radius: 4px;
            display: inline-block;
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease;
        }

        .token:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .token-word {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1976d2;
        }

        .token-medical {
            background: #fff3e0;
            border: 1px solid #ff9800;
            color: #f57c00;
            font-weight: bold;
        }

        .token-abbreviation {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            color: #388e3c;
            font-weight: bold;
        }

        .token-number {
            background: #fce4ec;
            border: 1px solid #e91e63;
            color: #c2185b;
        }

        .token-punctuation {
            background: #f3e5f5;
            border: 1px solid #9c27b0;
            color: #7b1fa2;
        }

        .token-subword {
            background: #fff8e1;
            border: 1px solid #ffc107;
            color: #f9a825;
        }

        .token-default {
            background: #f5f5f5;
            border: 1px solid #9e9e9e;
            color: #616161;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            text-align: center;
            border-top: 4px solid #3498db;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }

        .metric-label {
            color: #7f8c8d;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .optimization-result {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .optimization-before,
        .optimization-after {
            padding: 20px;
            border-radius: 12px;
            background: white;
        }

        .optimization-before {
            border-left: 5px solid #e74c3c;
        }

        .optimization-after {
            border-left: 5px solid #27ae60;
        }

        .optimization-summary {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            border: 2px solid #dee2e6;
        }

        .cost-analysis {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .cost-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .cost-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .recommendations {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .recommendation-item {
            margin: 10px 0;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
        }

        .batch-strategy {
            background: #e8f8f5;
            border: 2px solid #1abc9c;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .batch-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #1abc9c;
        }

        .educational-note {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
            position: relative;
        }

        .educational-note::before {
            content: "💡";
            font-size: 24px;
            position: absolute;
            top: 15px;
            right: 20px;
        }

        .warning-box {
            background: #fff5f5;
            border: 2px solid #fed7d7;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            color: #c53030;
        }

        .warning-box::before {
            content: "⚠️ ";
            font-size: 20px;
        }

        .context-management {
            background: #f0f8ff;
            border: 2px solid #87ceeb;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #ecf0f1;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2ecc71);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .token-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .optimization-result {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                flex-direction: column;
                align-items: center;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from { transform: translateX(-20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>🔤 Tokens and Tokenization</h1>
            <p class="subtitle">Understanding AI Token Economics and Optimization in Medical Applications</p>
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showPanel('analyzer')">📊 Token Analyzer</button>
                <button class="nav-tab" onclick="showPanel('optimizer')">⚡ Optimizer</button>
                <button class="nav-tab" onclick="showPanel('calculator')">💰 Cost Calculator</button>
                <button class="nav-tab" onclick="showPanel('batch')">📦 Batch Processor</button>
                <button class="nav-tab" onclick="showPanel('context')">🎯 Context Manager</button>
                <button class="nav-tab" onclick="showPanel('educational')">📚 Educational</button>
            </div>
        </div>

        <div class="main-content">
            <!-- Token Analyzer Panel -->
            <div id="analyzer" class="panel active">
                <h2>Token Analysis & Visualization</h2>
                <div class="educational-note">
                    <h3>Understanding Tokenization</h3>
                    <p>Tokenization breaks text into smaller units (tokens) that AI models can process. Each token has a cost, so understanding tokenization helps optimize expenses and performance in medical AI applications.</p>
                </div>

                <div class="input-group">
                    <label for="analyzeText">Medical Text to Analyze:</label>
                    <textarea id="analyzeText" rows="6" placeholder="Enter medical text, chest X-ray report, or AI prompt to analyze token usage...

Example: 'Please analyze this chest radiograph for signs of pneumonia. The patient is a 45-year-old male with fever and cough for 3 days. Look for consolidation, infiltrates, or pleural effusion in both lung fields.'"></textarea>
                </div>

                <div class="input-group">
                    <button class="btn" onclick="analyzeTokens()">
                        🔍 Analyze Tokens
                        <span id="analyzeLoading" class="loading" style="display: none;"></span>
                    </button>
                    <button class="btn success" onclick="visualizeTokens()">🎨 Visualize Tokens</button>
                    <button class="btn warning" onclick="loadSampleMedicalText()">📄 Load Sample</button>
                </div>

                <div id="tokenResults" class="results-area" style="display: none;">
                    <h3>Analysis Results</h3>
                    <div id="tokenMetrics" class="metrics-grid"></div>
                    <div id="tokenVisualization" class="token-visualization"></div>
                    <div id="tokenInsights" class="recommendations"></div>
                </div>
            </div>

            <!-- Optimizer Panel -->
            <div id="optimizer" class="panel">
                <h2>Token Optimization</h2>
                <div class="educational-note">
                    <h3>Smart Token Optimization</h3>
                    <p>Reduce token costs by 20-60% through medical abbreviations, prompt compression, and intelligent restructuring while maintaining medical accuracy and clarity.</p>
                </div>

                <div class="input-group">
                    <label for="optimizeText">Text to Optimize:</label>
                    <textarea id="optimizeText" rows="6" placeholder="Enter text to optimize for token efficiency..."></textarea>
                </div>

                <div class="input-group">
                    <label for="optimizationStrategy">Optimization Strategy:</label>
                    <select id="optimizationStrategy">
                        <option value="conservative">Conservative (Safe medical accuracy)</option>
                        <option value="balanced">Balanced (Good efficiency + safety)</option>
                        <option value="aggressive">Aggressive (Maximum savings)</option>
                    </select>
                </div>

                <div class="input-group">
                    <button class="btn success" onclick="optimizeText()">
                        ⚡ Optimize Text
                        <span id="optimizeLoading" class="loading" style="display: none;"></span>
                    </button>
                    <button class="btn" onclick="showOptimizationStrategies()">📋 View Strategies</button>
                </div>

                <div id="optimizationResults" class="results-area" style="display: none;">
                    <h3>Optimization Results</h3>
                    <div id="optimizationComparison" class="optimization-result"></div>
                    <div id="optimizationSummary" class="optimization-summary"></div>
                    <div id="optimizationRecommendations" class="recommendations"></div>
                </div>
            </div>

            <!-- Cost Calculator Panel -->
            <div id="calculator" class="panel">
                <h2>Token Cost Calculator</h2>
                <div class="educational-note">
                    <h3>Understanding AI Costs</h3>
                    <p>Calculate exact costs for different AI models and usage patterns. Essential for budgeting medical AI implementations and ROI analysis.</p>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="inputTokens">Input Tokens:</label>
                        <input type="number" id="inputTokens" value="500" min="0">
                    </div>
                    <div class="input-group">
                        <label for="outputTokens">Output Tokens:</label>
                        <input type="number" id="outputTokens" value="800" min="0">
                    </div>
                </div>

                <div class="input-group">
                    <label for="modelSelection">AI Model:</label>
                    <select id="modelSelection">
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo (Cost Effective)</option>
                        <option value="gpt-4">GPT-4 (High Performance)</option>
                        <option value="gpt-4-32k">GPT-4 32K (Large Context)</option>
                        <option value="gemini-pro">Gemini Pro (Google)</option>
                        <option value="claude-3-sonnet">Claude 3 Sonnet (Anthropic)</option>
                    </select>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;">
                    <div class="input-group">
                        <label for="requestsPerDay">Requests/Day:</label>
                        <input type="number" id="requestsPerDay" value="100" min="1">
                    </div>
                    <div class="input-group">
                        <label for="workingDays">Working Days/Year:</label>
                        <input type="number" id="workingDays" value="250" min="1">
                    </div>
                    <div class="input-group">
                        <button class="btn" onclick="calculateCosts()" style="margin-top: 25px;">
                            💰 Calculate Costs
                        </button>
                    </div>
                </div>

                <div id="costResults" class="cost-analysis" style="display: none;">
                    <h3>💰 Cost Analysis</h3>
                    <div id="costBreakdown" class="cost-grid"></div>
                    <div id="annualProjection" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Batch Processor Panel -->
            <div id="batch" class="panel">
                <h2>Batch Processing Strategy</h2>
                <div class="educational-note">
                    <h3>Efficient Batch Processing</h3>
                    <p>Process multiple medical cases in single API calls to reduce overhead costs by 40-60%. Ideal for bulk image analysis or report generation.</p>
                </div>

                <div class="input-group">
                    <label for="batchCases">Medical Cases (one per line):</label>
                    <textarea id="batchCases" rows="8" placeholder="Enter medical cases, one per line:

45-year-old male with chest pain and shortness of breath
67-year-old female with chronic cough and weight loss  
52-year-old male with fever and productive cough
38-year-old female with acute chest pain
..."></textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="maxBatchTokens">Max Tokens per Batch:</label>
                        <input type="number" id="maxBatchTokens" value="3000" min="500" max="30000">
                    </div>
                    <div class="input-group">
                        <button class="btn success" onclick="createBatchStrategy()" style="margin-top: 25px;">
                            📦 Create Batch Strategy
                        </button>
                    </div>
                </div>

                <div id="batchResults" class="batch-strategy" style="display: none;">
                    <h3>📦 Batch Processing Strategy</h3>
                    <div id="batchSummary"></div>
                    <div id="batchDetails"></div>
                </div>
            </div>

            <!-- Context Manager Panel -->
            <div id="context" class="panel">
                <h2>Context Window Management</h2>
                <div class="educational-note">
                    <h3>Smart Context Management</h3>
                    <p>Optimize context window usage to fit maximum information within model limits. Critical for complex medical analysis requiring multiple examples.</p>
                </div>

                <div class="input-group">
                    <label for="systemPrompt">System Prompt:</label>
                    <textarea id="systemPrompt" rows="4" placeholder="Enter your system prompt...">You are a medical AI assistant specializing in chest X-ray analysis. Analyze images for signs of pneumonia, focusing on consolidation, infiltrates, and pleural effusion.</textarea>
                </div>

                <div class="input-group">
                    <label for="userPrompt">User Prompt:</label>
                    <textarea id="userPrompt" rows="4" placeholder="Enter your user prompt...">Please analyze this chest X-ray for pneumonia. Patient is 45-year-old male with 3-day history of fever, cough, and shortness of breath.</textarea>
                </div>

                <div class="input-group">
                    <label for="contextExamples">Examples (one per line):</label>
                    <textarea id="contextExamples" rows="6" placeholder="Enter example prompts/responses...">Example 1: Normal chest X-ray shows clear lung fields with no consolidation
Example 2: Pneumonia visible as consolidation in right lower lobe
Example 3: Bilateral infiltrates suggest widespread infection</textarea>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div class="input-group">
                        <label for="contextModel">Model:</label>
                        <select id="contextModel">
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo (4K)</option>
                            <option value="gpt-4">GPT-4 (8K)</option>
                            <option value="gpt-4-32k">GPT-4 32K</option>
                            <option value="gemini-pro">Gemini Pro (32K)</option>
                            <option value="claude-3-sonnet">Claude 3 Sonnet (200K)</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <button class="btn" onclick="manageContext()" style="margin-top: 25px;">
                            🎯 Manage Context
                        </button>
                    </div>
                </div>

                <div id="contextResults" class="context-management" style="display: none;">
                    <h3>🎯 Context Window Analysis</h3>
                    <div id="contextUtilization"></div>
                    <div id="contextRecommendations"></div>
                </div>
            </div>

            <!-- Educational Panel -->
            <div id="educational" class="panel">
                <h2>Educational Resources</h2>
                
                <div class="educational-note">
                    <h3>🎓 Tokenization Fundamentals</h3>
                    <p><strong>What are Tokens?</strong> Tokens are the basic units that AI models process. They can be words, parts of words, or characters. Understanding tokens is crucial for cost optimization and performance tuning.</p>
                </div>

                <div class="warning-box">
                    <strong>Medical AI Safety:</strong> Always validate AI outputs with qualified medical professionals. Token optimization should never compromise medical accuracy or patient safety.
                </div>

                <div class="token-legend">
                    <div class="legend-item">
                        <div class="legend-color token-word"></div>
                        <span>Regular Words</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color token-medical"></div>
                        <span>Medical Terms</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color token-abbreviation"></div>
                        <span>Abbreviations</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color token-number"></div>
                        <span>Numbers</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color token-punctuation"></div>
                        <span>Punctuation</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color token-subword"></div>
                        <span>Subwords</span>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                    <div class="metric-card">
                        <div class="metric-value" id="totalAnalyses">0</div>
                        <div class="metric-label">Total Analyses</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalTokensProcessed">0</div>
                        <div class="metric-label">Tokens Processed</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="averageTokens">0</div>
                        <div class="metric-label">Avg Tokens/Analysis</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="costSavings">$0.00</div>
                        <div class="metric-label">Cost Savings</div>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 30px;">
                    <button class="btn" onclick="showTokenizationDemo()">🎮 Interactive Demo</button>
                    <button class="btn success" onclick="showBestPractices()">✅ Best Practices</button>
                    <button class="btn warning" onclick="showTroubleshooting()">🔧 Troubleshooting</button>
                    <button class="btn danger" onclick="resetStatistics()">🔄 Reset Stats</button>
                </div>

                <div id="educationalContent" class="results-area" style="display: none;"></div>
            </div>
        </div>
    </div>

    <script src="tokens_tokenization_app.js"></script>
    <script>
        // UI Management Functions
        function showPanel(panelId) {
            // Hide all panels
            document.querySelectorAll('.panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected panel
            document.getElementById(panelId).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Update statistics in educational panel
            if (panelId === 'educational') {
                updateEducationalStats();
            }
        }

        // Token Analysis Functions
        function analyzeTokens() {
            const text = document.getElementById('analyzeText').value.trim();
            if (!text) {
                alert('Please enter text to analyze');
                return;
            }

            const loadingElement = document.getElementById('analyzeLoading');
            loadingElement.style.display = 'inline-block';

            setTimeout(() => {
                const analysis = tokenizationSystem.generateTokenAnalysis(text, true);
                displayTokenAnalysis(analysis);
                tokenizationSystem.updateStatistics(analysis.tokenization.estimatedTokens);
                loadingElement.style.display = 'none';
            }, 500);
        }

        function displayTokenAnalysis(analysis) {
            const resultsArea = document.getElementById('tokenResults');
            const metricsDiv = document.getElementById('tokenMetrics');
            const insightsDiv = document.getElementById('tokenInsights');
            
            // Display metrics
            metricsDiv.innerHTML = `
                <div class="metric-card">
                    <div class="metric-value">${analysis.tokenization.estimatedTokens}</div>
                    <div class="metric-label">Estimated Tokens</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${analysis.input.wordCount}</div>
                    <div class="metric-label">Word Count</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${analysis.metrics.charsPerToken}</div>
                    <div class="metric-label">Chars/Token</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${analysis.tokenization.medicalTerms.length}</div>
                    <div class="metric-label">Medical Terms</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">$${analysis.costAnalysis.totalCost.toFixed(4)}</div>
                    <div class="metric-label">Est. Cost (GPT-3.5)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value">${analysis.metrics.medicalTermDensity}%</div>
                    <div class="metric-label">Medical Density</div>
                </div>
            `;
            
            // Display recommendations
            if (analysis.recommendations.length > 0) {
                insightsDiv.innerHTML = '<h4>💡 Optimization Recommendations</h4>' +
                    analysis.recommendations.map(rec => `
                        <div class="recommendation-item">
                            <strong>${rec.type.toUpperCase()}:</strong> ${rec.description}
                            <br><small>Priority: ${rec.priority} | Potential Savings: ${rec.potentialSavings}</small>
                        </div>
                    `).join('');
            }
            
            resultsArea.style.display = 'block';
            resultsArea.classList.add('fade-in');
        }

        function visualizeTokens() {
            const text = document.getElementById('analyzeText').value.trim();
            if (!text) {
                alert('Please enter text to visualize');
                return;
            }

            const visualization = tokenizationSystem.createTokenVisualization(text);
            const visualDiv = document.getElementById('tokenVisualization');
            
            // Create token display using the UI helper
            const tokenDisplay = TokenVisualizationUI.createTokenDisplay(visualization);
            
            visualDiv.innerHTML = '<h4>🎨 Token Visualization</h4>';
            visualDiv.appendChild(tokenDisplay);
            
            // Add educational insights
            if (visualization.educational.length > 0) {
                const insightsHtml = '<div class="educational-note"><h4>📚 Educational Insights</h4>' +
                    visualization.educational.map(insight => `
                        <p><strong>${insight.type.replace('_', ' ').toUpperCase()}:</strong> ${insight.message}</p>
                        ${insight.examples ? `<p><em>Examples: ${insight.examples.join(', ')}</em></p>` : ''}
                    `).join('') + '</div>';
                
                visualDiv.innerHTML += insightsHtml;
            }
        }

        function loadSampleMedicalText() {
            const sampleText = `Please analyze this chest radiograph for signs of pneumonia. The patient is a 45-year-old male with fever and cough for 3 days. 

Clinical History:
- Temperature: 101.5°F
- Heart rate: 95 BPM
- Respiratory rate: 22/min
- Blood pressure: 128/82 mmHg
- O2 saturation: 94% on room air

Please examine the following areas:
1. Bilateral lung fields for consolidation
2. Pleural spaces for effusion
3. Heart size and mediastinum
4. Bony structures for abnormalities

Provide diagnosis with confidence level and supporting evidence from the radiographic findings. Consider differential diagnoses including pneumonia, tuberculosis, and pulmonary edema.`;
            
            document.getElementById('analyzeText').value = sampleText;
        }

        // Optimization Functions
        function optimizeText() {
            const text = document.getElementById('optimizeText').value.trim();
            const strategy = document.getElementById('optimizationStrategy').value;
            
            if (!text) {
                alert('Please enter text to optimize');
                return;
            }

            const loadingElement = document.getElementById('optimizeLoading');
            loadingElement.style.display = 'inline-block';

            setTimeout(() => {
                const optimization = tokenizationSystem.optimizeForTokens(text, strategy);
                displayOptimizationResults(optimization);
                
                const costSavings = (optimization.tokenSavings * 0.0015 / 1000); // Estimate savings
                tokenizationSystem.updateStatistics(optimization.originalTokens, costSavings);
                
                loadingElement.style.display = 'none';
            }, 800);
        }

        function displayOptimizationResults(optimization) {
            const resultsArea = document.getElementById('optimizationResults');
            const comparisonDiv = document.getElementById('optimizationComparison');
            const summaryDiv = document.getElementById('optimizationSummary');
            const recommendationsDiv = document.getElementById('optimizationRecommendations');
            
            // Comparison display
            comparisonDiv.innerHTML = `
                <div class="optimization-before">
                    <h4>📝 Original Text</h4>
                    <p><strong>Tokens:</strong> ${optimization.originalTokens}</p>
                    <div class="token-display">${optimization.original}</div>
                </div>
                <div class="optimization-after">
                    <h4>⚡ Optimized Text</h4>
                    <p><strong>Tokens:</strong> ${optimization.optimizedTokens}</p>
                    <div class="token-display">${optimization.optimized}</div>
                </div>
            `;
            
            // Summary
            summaryDiv.innerHTML = `
                <h4>📊 Optimization Summary</h4>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${optimization.tokenSavings}</div>
                        <div class="metric-label">Tokens Saved</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${optimization.savingsPercentage}%</div>
                        <div class="metric-label">Percentage Saved</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${optimization.optimizations.length}</div>
                        <div class="metric-label">Optimizations Applied</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${optimization.strategy}</div>
                        <div class="metric-label">Strategy Used</div>
                    </div>
                </div>
            `;
            
            // Optimizations applied
            if (optimization.optimizations.length > 0) {
                recommendationsDiv.innerHTML = '<h4>🔧 Applied Optimizations</h4>' +
                    optimization.optimizations.map(opt => `
                        <div class="recommendation-item">
                            <strong>${opt.type.toUpperCase()}:</strong> Saved ${opt.tokenSavings} tokens
                        </div>
                    `).join('');
            }
            
            resultsArea.style.display = 'block';
            resultsArea.classList.add('fade-in');
        }

        function showOptimizationStrategies() {
            const strategies = tokenizationSystem.optimizationStrategies;
            const content = Object.entries(strategies).map(([key, strategy]) => `
                <div class="recommendation-item">
                    <strong>${strategy.name}:</strong> ${strategy.description}
                    <br><small>Potential Savings: ${(strategy.savings * 100).toFixed(0)}% | Risk Level: ${strategy.risk}</small>
                </div>
            `).join('');
            
            alert('Optimization Strategies:\n\n' + content.replace(/<[^>]*>/g, ''));
        }

        // Cost Calculation Functions
        function calculateCosts() {
            const inputTokens = parseInt(document.getElementById('inputTokens').value) || 0;
            const outputTokens = parseInt(document.getElementById('outputTokens').value) || 0;
            const model = document.getElementById('modelSelection').value;
            const requestsPerDay = parseInt(document.getElementById('requestsPerDay').value) || 1;
            const workingDays = parseInt(document.getElementById('workingDays').value) || 250;
            
            const costAnalysis = tokenizationSystem.calculateCost(inputTokens, outputTokens, model);
            const annualProjection = tokenizationSystem.projectAnnualSavings(
                costAnalysis.totalCost, requestsPerDay, workingDays
            );
            
            displayCostResults(costAnalysis, annualProjection, model);
        }

        function displayCostResults(costAnalysis, annualProjection, model) {
            const resultsArea = document.getElementById('costResults');
            const breakdownDiv = document.getElementById('costBreakdown');
            const projectionDiv = document.getElementById('annualProjection');
            
            breakdownDiv.innerHTML = `
                <div class="cost-item">
                    <h4>Input Cost</h4>
                    <p>$${costAnalysis.inputCost.toFixed(4)}</p>
                    <small>${costAnalysis.inputTokens} tokens</small>
                </div>
                <div class="cost-item">
                    <h4>Output Cost</h4>
                    <p>$${costAnalysis.outputCost.toFixed(4)}</p>
                    <small>${costAnalysis.outputTokens} tokens</small>
                </div>
                <div class="cost-item">
                    <h4>Total Cost</h4>
                    <p>$${costAnalysis.totalCost.toFixed(4)}</p>
                    <small>per request</small>
                </div>
                <div class="cost-item">
                    <h4>Model</h4>
                    <p>${model}</p>
                    <small>selected model</small>
                </div>
            `;
            
            projectionDiv.innerHTML = `
                <h4>📈 Annual Cost Projection</h4>
                <div class="cost-grid">
                    <div class="cost-item">
                        <h5>Daily</h5>
                        <p>$${annualProjection.perDay.toFixed(2)}</p>
                    </div>
                    <div class="cost-item">
                        <h5>Monthly</h5>
                        <p>$${annualProjection.perMonth.toFixed(2)}</p>
                    </div>
                    <div class="cost-item">
                        <h5>Annual</h5>
                        <p>$${annualProjection.perYear.toFixed(2)}</p>
                    </div>
                </div>
            `;
            
            resultsArea.style.display = 'block';
            resultsArea.classList.add('fade-in');
        }

        // Batch Processing Functions
        function createBatchStrategy() {
            const casesText = document.getElementById('batchCases').value.trim();
            const maxTokens = parseInt(document.getElementById('maxBatchTokens').value) || 3000;
            
            if (!casesText) {
                alert('Please enter medical cases to batch');
                return;
            }
            
            const cases = casesText.split('\n').filter(case_ => case_.trim()).map(case_ => ({
                description: case_.trim()
            }));
            
            const batchStrategy = tokenizationSystem.createBatchStrategy(cases, maxTokens);
            displayBatchResults(batchStrategy);
        }

        function displayBatchResults(strategy) {
            const resultsArea = document.getElementById('batchResults');
            const summaryDiv = document.getElementById('batchSummary');
            const detailsDiv = document.getElementById('batchDetails');
            
            summaryDiv.innerHTML = `
                <h4>📊 Batch Strategy Summary</h4>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${strategy.totalBatches}</div>
                        <div class="metric-label">Total Batches</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${strategy.averageCasesPerBatch}</div>
                        <div class="metric-label">Avg Cases/Batch</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${strategy.tokenSavings.efficiency}%</div>
                        <div class="metric-label">Efficiency Gain</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${strategy.tokenSavings.savings}</div>
                        <div class="metric-label">Tokens Saved</div>
                    </div>
                </div>
            `;
            
            detailsDiv.innerHTML = '<h4>📦 Batch Details</h4>' +
                strategy.batches.map((batch, index) => `
                    <div class="batch-item">
                        <h5>Batch ${index + 1} (${batch.tokenCount} tokens)</h5>
                        <p><strong>Cases:</strong> ${batch.cases.length}</p>
                        <details>
                            <summary>View Batch Content</summary>
                            <div class="token-display">${batch.prompt}</div>
                        </details>
                    </div>
                `).join('');
            
            resultsArea.style.display = 'block';
            resultsArea.classList.add('fade-in');
        }

        // Context Management Functions
        function manageContext() {
            const systemPrompt = document.getElementById('systemPrompt').value.trim();
            const userPrompt = document.getElementById('userPrompt').value.trim();
            const examplesText = document.getElementById('contextExamples').value.trim();
            const model = document.getElementById('contextModel').value;
            
            const examples = examplesText.split('\n').filter(ex => ex.trim());
            
            const contextManagement = tokenizationSystem.manageContextWindow(
                systemPrompt, userPrompt, examples, model
            );
            
            displayContextResults(contextManagement);
        }

        function displayContextResults(context) {
            const resultsArea = document.getElementById('contextResults');
            const utilizationDiv = document.getElementById('contextUtilization');
            const recommendationsDiv = document.getElementById('contextRecommendations');
            
            utilizationDiv.innerHTML = `
                <h4>📊 Context Window Utilization</h4>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${context.tokenUsage.utilizationPercent}%"></div>
                </div>
                <p>Using ${context.tokenUsage.utilizationPercent}% (${context.tokenUsage.total}/${context.tokenUsage.available} tokens)</p>
                
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value">${context.tokenUsage.system}</div>
                        <div class="metric-label">System Tokens</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${context.tokenUsage.user}</div>
                        <div class="metric-label">User Tokens</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${context.tokenUsage.examples}</div>
                        <div class="metric-label">Example Tokens</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">${context.examples.length}</div>
                        <div class="metric-label">Examples Included</div>
                    </div>
                </div>
            `;
            
            if (context.recommendations.length > 0) {
                recommendationsDiv.innerHTML = '<h4>💡 Context Recommendations</h4>' +
                    context.recommendations.map(rec => `
                        <div class="recommendation-item">
                            <strong>${rec.type.toUpperCase()}:</strong> ${rec.message}
                            <br><small>Priority: ${rec.priority}</small>
                        </div>
                    `).join('');
            }
            
            resultsArea.style.display = 'block';
            resultsArea.classList.add('fade-in');
        }

        // Educational Functions
        function updateEducationalStats() {
            const stats = tokenizationSystem.getStatistics();
            
            document.getElementById('totalAnalyses').textContent = stats.totalAnalyses;
            document.getElementById('totalTokensProcessed').textContent = stats.totalTokensProcessed.toLocaleString();
            document.getElementById('averageTokens').textContent = Math.round(stats.averageTokensPerAnalysis);
            document.getElementById('costSavings').textContent = `$${stats.costSavings.toFixed(2)}`;
        }

        function showTokenizationDemo() {
            const content = document.getElementById('educationalContent');
            content.innerHTML = `
                <h3>🎮 Interactive Tokenization Demo</h3>
                <div class="educational-note">
                    <h4>Try These Examples:</h4>
                    <button class="btn" onclick="demoExample('medical')">Medical Report</button>
                    <button class="btn" onclick="demoExample('abbreviation')">Abbreviations</button>
                    <button class="btn" onclick="demoExample('numbers')">Numbers & Measurements</button>
                    <button class="btn" onclick="demoExample('complex')">Complex Medical Terms</button>
                </div>
                <div id="demoResults"></div>
            `;
            content.style.display = 'block';
        }

        function demoExample(type) {
            const examples = {
                medical: "The patient presents with bilateral pneumonia and pleural effusion.",
                abbreviation: "The pt presents with bilat PNA and pleural effusion.",
                numbers: "Temperature 101.5°F, BP 120/80 mmHg, HR 95 BPM, O2 sat 94%",
                complex: "Pneumothorax with hemothorax requiring thoracentesis and pleural drainage."
            };
            
            const text = examples[type];
            const analysis = tokenizationSystem.generateTokenAnalysis(text, false);
            
            document.getElementById('demoResults').innerHTML = `
                <h4>Example: ${type}</h4>
                <div class="token-display">${text}</div>
                <p><strong>Tokens:</strong> ${analysis.tokenization.estimatedTokens} | 
                   <strong>Medical Terms:</strong> ${analysis.tokenization.medicalTerms.length} |
                   <strong>Efficiency:</strong> ${analysis.metrics.charsPerToken} chars/token</p>
            `;
        }

        function showBestPractices() {
            const content = document.getElementById('educationalContent');
            content.innerHTML = `
                <h3>✅ Tokenization Best Practices</h3>
                <div class="recommendations">
                    <div class="recommendation-item">
                        <strong>Use Medical Abbreviations:</strong> Replace "computed tomography" with "CT" to save ~50% tokens
                    </div>
                    <div class="recommendation-item">
                        <strong>Batch Processing:</strong> Combine multiple cases in single API calls for 40-60% cost reduction
                    </div>
                    <div class="recommendation-item">
                        <strong>Context Optimization:</strong> Keep prompts focused and remove unnecessary words
                    </div>
                    <div class="recommendation-item">
                        <strong>Template Reuse:</strong> Create efficient, reusable prompt templates
                    </div>
                    <div class="recommendation-item">
                        <strong>Monitor Usage:</strong> Track token consumption and optimize high-volume prompts
                    </div>
                </div>
            `;
            content.style.display = 'block';
        }

        function showTroubleshooting() {
            const content = document.getElementById('educationalContent');
            content.innerHTML = `
                <h3>🔧 Common Tokenization Issues</h3>
                <div class="warning-box">
                    <strong>Issue:</strong> Unexpectedly high token counts<br>
                    <strong>Solution:</strong> Check for hidden characters, long medical terms, or redundant text
                </div>
                <div class="warning-box">
                    <strong>Issue:</strong> Context window exceeded<br>
                    <strong>Solution:</strong> Break long prompts into smaller chunks or use batch processing
                </div>
                <div class="warning-box">
                    <strong>Issue:</strong> Medical abbreviations not recognized<br>
                    <strong>Solution:</strong> Use standard medical abbreviations and verify tokenization
                </div>
                <div class="warning-box">
                    <strong>Issue:</strong> High costs with frequent API calls<br>
                    <strong>Solution:</strong> Implement caching, batch processing, and prompt optimization
                </div>
            `;
            content.style.display = 'block';
        }

        function resetStatistics() {
            if (confirm('Are you sure you want to reset all statistics?')) {
                tokenizationSystem.statistics = {
                    totalAnalyses: 0,
                    totalTokensProcessed: 0,
                    averageTokensPerAnalysis: 0,
                    costSavings: 0,
                    optimizationSuccess: 0
                };
                updateEducationalStats();
                alert('Statistics reset successfully!');
            }
        }

        // Initialize the interface
        document.addEventListener('DOMContentLoaded', function() {
            // Load sample text if available
            const analyzeTextArea = document.getElementById('analyzeText');
            if (analyzeTextArea.value.trim() === '') {
                loadSampleMedicalText();
            }
            
            // Initialize educational stats
            updateEducationalStats();
            
            // Copy text to optimizer when analyzing
            document.getElementById('analyzeText').addEventListener('input', function() {
                document.getElementById('optimizeText').value = this.value;
            });
        });
    </script>
</body>
</html>
